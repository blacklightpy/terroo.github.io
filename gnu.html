<meta charset="utf-8">
<h1 id="tutorial-definitivo-do-gnu-autotools-para-iniciantes">Tutorial Definitivo do GNU Autotools para Iniciantes</h1>
<div class="figure">
<img src="autoconf_ahdr_dataflow.png" title="Tutorial Definitivo de Como Usar o GNU AutoTools" alt="Tutorial Definitivo de Como Usar o GNU AutoTools" />
<p class="caption">Tutorial Definitivo de Como Usar o GNU AutoTools</p>
</div>
<p>Apesar de existirem algumas outras alternativas às ferramentas automáticas do GNU, o GNU Autotools ainda é o mais utilizado no mundo por motivos de confiança em relação à resultados finais. Ou seja, a experiência levou à essa estabilidade.</p>
<p>Infelizmente, há muita documentação obsoleta na internet sobre o Autotools e muitas reclamações sobre ferramentas automáticas, por esse motivo decidi documentar um teste moderno e bem simplista que eu criei e vou compartilhar com vocês essa experiência que fiz questão de torná-la o mais básico possível para poder alcançar o entendimento.</p>
<p>Mas ainda assim, não deixe de exibir exemplos que funcionem em projetos maiores, que por sinal a ideia é a mesma, só precisa ter um pouco mais de atenção nas configurações.</p>
<h4 id="esse-artigo-se-resumirá-em">Esse artigo se resumirá em:</h4>
<blockquote>
<p>Todos os tópicos foram separados com <strong>Passo à Passo</strong> e <strong>Listas ordenadas</strong> para facilitar a compreensão.</p>
</blockquote>
<h3 id="introdução">1. Introdução</h3>
<h3 id="preparação-do-ambiente">2. Preparação do Ambiente</h3>
<h3 id="utilização-das-ferramentas-automáticas">3. Utilização das ferramentas automáticas</h3>
<h3 id="explicações-teóricas-de-cada-comando-e-arquivo">4. Explicações teóricas de cada comando e arquivo</h3>
<h3 id="recursos-prontos-no-git-meus-exemplos">5. Recursos prontos no Git (meus exemplos)</h3>
<h3 id="scripts-em-bash-facilitam-notar-os-passos">6. Scripts em Bash (facilitam notar os passos)</h3>
<h3 id="resumo-mini-mapa-mental">7. Resumo (Mini mapa mental)</h3>
<h3 id="referências-bibliográficas">8. Referências bibliográficas</h3>
<hr />
<h2 id="introdução-1">Introdução</h2>
<p>O <a href="https://www.gnu.org/software/autoconf/">GNU Autotools</a> , também conhecido como <a href="https://www.gnu.org/software/automake/">GNU Build System</a> , é um conjunto de ferramentas de programação projetadas para ajudar a tornar os pacotes de código-fonte portáteis para muitos sistemas Unix .</p>
<p>Pode ser difícil tornar um programa de software portátil: o compilador <a href="https://terminalroot.com.br/2017/01/codigo-de-linguagem-c-para-aprendizado.html">C</a> difere de sistema para sistema; algumas funções da biblioteca estão ausentes em alguns sistemas; arquivos de cabeçalho podem ter nomes diferentes. Uma maneira de lidar com isso é escrever código condicional, com blocos de código selecionados por meio de diretivas de pré-processador ( <code>#ifdef</code> ); mas devido à grande variedade de ambientes de construção, essa abordagem rapidamente se torna incontrolável. O <a href="https://www.gnu.org/software/libtool/">Autotools</a> foi projetado para solucionar esse problema de maneira mais fácil.</p>
<p>O Autotools faz parte da cadeia de ferramentas GNU e é amplamente utilizado em muitos pacotes de software livre e de código aberto . Suas ferramentas componentes são licenciadas por software livre sob a Licença Pública Geral GNU, com exceções especiais de licença permitindo seu uso com software proprietário .</p>
<p>O GNU Build System possibilita a criação de muitos programas usando um processo de duas etapas: configure seguido por make .</p>
<p>O Autotools consiste nos programas utilitários <a href="https://www.gnu.org/software/autoconf/">GNU Autoconf</a> , <a href="https://www.gnu.org/software/automake/">Automake</a> e <a href="https://www.gnu.org/software/libtool/">Libtool</a> . Outras ferramentas relacionadas frequentemente usadas ao lado dele incluem o programa <a href="https://www.gnu.org/software/make/">GNU make</a>, o <a href="https://www.gnu.org/software/gettext/">GNU gettext</a> , o <a href="https://www.freedesktop.org/wiki/Software/pkg-config/">pkg-config</a> e o <a href="https://gcc.gnu.org/">GNU Compiler Collection</a> , também chamada [GCC/G++].</p>
<hr />
<h2 id="º-parte-configurando-os-arquivos-para-testes">1º Parte: Configurando os arquivos para testes</h2>
<ol style="list-style-type: decimal">
<li><p>Criar os diretórios para os testes:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">mkdir</span> testes <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> testes
<span class="fu">mkdir</span> doc examples man scripts src</code></pre></div></li>
<li><p>Criar os arquivos para os teste</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">touch</span> doc/README.md examples/my-example-teste.dat man/teste.1 scripts/script-teste.sh src/teste.c</code></pre></div></li>
<li><p>Popular os arquivos</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="co"># Conteúdo para o arquivo em doc/</span>
<span class="bu">echo</span> <span class="st">&quot;Documentação para o teste&quot;</span> <span class="op">&gt;&gt;</span> doc/README.md

<span class="co"># Conteúdo para o arquivo em examples/</span>
<span class="bu">echo</span> -e <span class="st">&#39;#!/bin/bash\necho &quot;Teste em Bash&quot;\nexit 0&#39;</span> <span class="op">&gt;&gt;</span> examples/my-example-teste.dat

<span class="co"># Conteúdo para o arquivo em man/</span>
<span class="bu">echo</span> -e <span class="st">&#39;.\&quot; DO NOT MODIFY THIS FILE!  It was generated by help2man 1.47.8.</span>
<span class="st">.TH teste &quot;1&quot; &quot;October 2019&quot; &quot;teste 1.1&quot; &quot;User Commands&quot;</span>
<span class="st">.SH NAME</span>
<span class="st">teste \- Only teste for Autotools.&#39;</span> <span class="op">&gt;</span> man/teste.1

<span class="co"># Conteúdo para o arquivo em scripts/</span>
<span class="bu">echo</span> -e <span class="st">&#39;#!/bin/sh\nprintf &quot;Only a teste\\n&quot; &quot;%s&quot;\nexit 0&#39;</span> <span class="op">&gt;</span> scripts/script-teste.sh

<span class="co"># Conteúdo para o arquivo em src/</span>
<span class="bu">echo</span> -e <span class="st">&#39;#include &lt;stdio.h&gt;</span>

<span class="st">int main(){</span>
<span class="st">    printf(&quot;Somente um teste para o Autotools\\n&quot;);</span>
<span class="st">    return 0;</span>
<span class="st">}&#39;</span> <span class="op">&gt;</span> src/teste.c</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><p>Resultado final dos arquivos:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">testes/</span>
├── <span class="ex">doc</span>
│   └── <span class="ex">README.md</span>
├── <span class="ex">examples</span>
│   └── <span class="ex">my-example-teste.dat</span>
├── <span class="fu">man</span>
│   └── <span class="ex">teste.1</span>
├── <span class="ex">scripts</span>
│   └── <span class="ex">script-teste.sh</span>
└── <span class="ex">src</span>
└── <span class="ex">teste.c</span>
<span class="ex">5</span> directories, 5 files</code></pre></div></li>
<li><p>Opcional: hash do diretório:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">ls</span> ../testes/ <span class="kw">|</span> <span class="ex">md5sum</span>
<span class="ex">ac0bacadc6861ab22a44af572b255ff1</span>  -</code></pre></div></li>
</ol>
<hr />
<h2 id="º-parte-utilizando-as-ferramentas-do-gnu-autotools">2º Parte: Utilizando as ferramentas do GNU Autotools</h2>
<ol style="list-style-type: decimal">
<li><p>Gerar o arquivo <code>configure.ac</code>, execute:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">autoscan</span></code></pre></div></li>
</ol>
<blockquote>
<p>Foram criados os arquivos: <code>autoscan-2.69.log</code> e <code>configure.scan</code> . Onde o conteúdo de <em>autoscan-2.69.log</em> está vazio e o conteúdo de <em>configure.ac</em> é:</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="co">#                                               -*- Autoconf -*-</span>
<span class="co"># Process this file with autoconf to produce a configure script.</span>

<span class="ex">AC_PREREQ</span>([2.69])
<span class="ex">AC_INIT</span>([FULL-PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDRESS])
<span class="ex">AC_CONFIG_SRCDIR</span>([src/teste.c])
<span class="ex">AC_CONFIG_HEADERS</span>([config.h])

<span class="co"># Checks for programs.</span>
<span class="ex">AC_PROG_CC</span>

<span class="co"># Checks for libraries.</span>

<span class="co"># Checks for header files.</span>

<span class="co"># Checks for typedefs, structures, and compiler characteristics.</span>

<span class="co"># Checks for library functions.</span>

<span class="ex">AC_OUTPUT</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>Renomear o arquivo <code>configure.scan</code> para <code>configure.ac</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">mv</span> configure.scan configure.ac</code></pre></div></li>
<li><p>Alterar a linha do arquivo <code>configure.ac</code> que possui as informações: <strong>AC_INIT(FULL-PACKAGE-NAME, VERSION, BUG-REPORT-ADDRESS)</strong> para os nomes do seu projeto, ex.: <strong>AC_INIT(teste, 1.0, teste@terminalroot.com.br)</strong> . Caso deseje, use o <a href="">Sed</a> para isso, assim:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sed</span> -i <span class="st">&#39;s/FULL-PACKAGE-NAME\],/teste],/g&#39;</span> configure.ac
<span class="fu">sed</span> -i <span class="st">&#39;s/VERSION\],/1.0],/g&#39;</span> configure.ac
<span class="fu">sed</span> -i <span class="st">&#39;s/BUG-REPORT-ADDRESS\]/teste@terminalroot.com.br]/g&#39;</span> configure.ac</code></pre></div>
<blockquote>
<p>Ou use um editor de texto de preferência, exemplo: <a href="">Vim</a> .</p>
</blockquote></li>
</ol>
<p>Ao final meu arquivo ficou assim:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="co">#                                               -*- Autoconf -*-</span>
<span class="co"># Process this file with autoconf to produce a configure script.</span>

<span class="ex">AC_PREREQ</span>([2.69])
<span class="ex">AC_INIT</span>([teste], [1.0], [teste@terminalroot.com.br])
<span class="ex">AC_CONFIG_SRCDIR</span>([src/teste.c])
<span class="ex">AC_CONFIG_HEADERS</span>([config.h])

<span class="co"># Checks for programs.</span>
<span class="ex">AC_PROG_CC</span>

<span class="co"># Checks for libraries.</span>

<span class="co"># Checks for header files.</span>

<span class="co"># Checks for typedefs, structures, and compiler characteristics.</span>

<span class="co"># Checks for library functions.</span>

<span class="ex">AC_OUTPUT</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><p>Gerando um script <code>configure</code> inicial:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">autoconf</span></code></pre></div>
<blockquote>
<p>Foram criados 1 novo diretório e 1 novos arquivo: <code>autom4te.cache/</code> e o <code>configure</code> . O conteúdo dos mesmos são extensos, o <code>configure</code> por exemplo possui <strong>3549 linhas</strong>.</p>
</blockquote></li>
<li><p>Criando o arquivo <code>Makefile.am</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">vim</span> Makefile.am</code></pre></div></li>
</ol>
<p>E insira esse conteúdo dentro:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">AUTOMAKE_OPTIONS</span> = foreign
<span class="ex">SUBDIRS</span> = src doc examples man scripts</code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li><p>Criando o arquivo <code>Makefile.am</code> só que desta vez dentro do diretório <code>src/</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">vim</span> src/Makefile.am</code></pre></div></li>
</ol>
<p>E insira esse conteúdo dentro:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="co"># what flags you want to pass to the C compiler &amp; linker</span>
<span class="ex">CFLAGS</span> = --pedantic -Wall -std=c99 -O2
<span class="co"># LDFLAGS =</span>
<span class="co"># this lists the binaries to produce, the (non-PHONY, binary) targets in</span>
<span class="co"># the previous manual Makefile</span>
<span class="ex">bin_PROGRAMS</span> = teste
<span class="ex">teste_SOURCES</span> = teste.c</code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li><p>Criando o arquivo <code>Makefile.am</code> só que desta vez dentro do diretório <code>man/</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">vim</span> man/Makefile.am</code></pre></div></li>
</ol>
<p>E insira esse conteúdo dentro:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">man_MANS</span> = teste.1</code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li><p>Criando o arquivo <code>Makefile.am</code> só que desta vez dentro do diretório <code>scripts/</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">vim</span> scripts/Makefile.am</code></pre></div></li>
</ol>
<p>E insira esse conteúdo dentro:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">bin_SCRIPTS</span> = script-teste.sh</code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li><p>Criando o arquivo <code>Makefile.am</code> só que desta vez dentro do diretório <code>doc/</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">vim</span> doc/Makefile.am</code></pre></div></li>
</ol>
<p>E insira esse conteúdo dentro:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">docdir</span> = <span class="va">$(</span><span class="ex">datadir</span><span class="va">)</span>/doc/@PACKAGE@
<span class="ex">doc_DATA</span> = README.md</code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li><p>Criando mais um arquivo <code>Makefile.am</code> só que desta vez dentro do diretório <code>examples/</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">vim</span> examples/Makefile.am</code></pre></div></li>
</ol>
<p>E insira esse conteúdo dentro:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">exampledir</span> = <span class="va">$(</span><span class="ex">datarootdir</span><span class="va">)</span>/doc/@PACKAGE@
<span class="ex">example_DATA</span> = my-example-teste.dat</code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>Integrando a parte da checagem (autoconf) com a parte da compilação (automake): &gt; Abra o arquivo <code>vim configure.ac</code></li>
</ol>
<p>E insira o conteúdo <strong>AM_INIT_AUTOMAKE(teste, 1.0)</strong>, logo depois do <strong>AC_INIT([teste], [1.0], [teste@terminalroot.com.br])</strong>: &gt; Se quiser que fique mais fácil, basta usar esse comando abaixo( <a href="">Sed</a> ):</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sed</span> -i <span class="st">&#39;/AC_INIT/{p;s/.*/AM_INIT_AUTOMAKE(teste, 1.0)/;}&#39;</span> configure.ac</code></pre></div>
<ol start="12" style="list-style-type: decimal">
<li>Deixe o autoconf gerar um script configure cuja saida será Makefiles para todos os diretórios citados: &gt; Alterando a linha que contém: <strong>AC_OUTPUT</strong> com <a href="">Sed</a> (caso deseje use um editor de texto e faça manualmente):</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sed</span> -i <span class="st">&#39;s@AC_OUTPUT@AC_OUTPUT(Makefile src/Makefile doc/Makefile examples/Makefile man/Makefile scripts/Makefile)@&#39;</span> configure.ac</code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li><p>Fazendo as ferramentas produzirem o script <code>configure</code> e os modelos de Makefile:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">aclocal</span></code></pre></div>
<blockquote>
<p>Foi gerado mais um arquivo no diretório raíz do projeto, com o nome: <code>aclocal.m4</code></p>
</blockquote></li>
<li><p>Produzindo o arquivo <code>Makefile.in</code> com o argumento <code>--add-missing</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">automake</span> --add-missing</code></pre></div>
<p>A saída será algo similar ou igual(se usou os arquivos desse tutorial) à:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">configure.ac</span>:6: warning: AM_INIT_AUTOMAKE: two- and three-arguments forms are deprecated.  For more info, see:
<span class="ex">configure.ac</span>:6: https://www.gnu.org/software/automake/manual/automake.html#Modernize-AM_005fINIT_005fAUTOMAKE-invocation
<span class="ex">configure.ac</span>:11: installing <span class="st">&#39;./compile&#39;</span>
<span class="ex">configure.ac</span>:6: installing <span class="st">&#39;./install-sh&#39;</span>
<span class="ex">configure.ac</span>:6: installing <span class="st">&#39;./missing&#39;</span>
<span class="ex">configure.ac</span>:8: error: required file <span class="st">&#39;config.h.in&#39;</span> not found
<span class="ex">src</span>/Makefile.am: <span class="ex">installing</span> <span class="st">&#39;./depcomp&#39;</span>
<span class="ex">src</span>/Makefile.am:<span class="ex">2</span>: warning: <span class="st">&#39;CFLAGS&#39;</span> is a user variable, you should not override it<span class="kw">;</span>
<span class="ex">src</span>/Makefile.am:<span class="ex">2</span>: use <span class="st">&#39;AM_CFLAGS&#39;</span> instead
<span class="ex">src</span>/Makefile.am:<span class="ex">3</span>: warning: <span class="st">&#39;LDFLAGS&#39;</span> is a user variable, you should not override it<span class="kw">;</span>
<span class="ex">src</span>/Makefile.am:<span class="ex">3</span>: use <span class="st">&#39;AM_LDFLAGS&#39;</span> instead</code></pre></div></li>
</ol>
<p>Perceba a linha: <strong>configure.ac:8: error: required file 'config.h.in' not found</strong> , se isso aparecer também para você, rode:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">autoreconf</span> -fi</code></pre></div>
<ol start="15" style="list-style-type: decimal">
<li><p>E finalmente geramos o script final do <code>configure</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">autoconf</span></code></pre></div></li>
</ol>
<p>Se quiser verificar se está tudo certo, rode o <code>./configure</code>, o <code>make</code> e teste a execução do programa: <code>cd src/ &amp;&amp; ./teste</code> , a saída será: <strong>Somente um teste para o Autotools</strong> . E se quiser instalar no sistema, rode: &gt; Considerando que você tem o <code>sudo</code> instalado e faz parte do grupo, caso contrário o <code>make install</code> só funcionará com o <code>root</code>.</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">./configure</span>
<span class="fu">make</span>
<span class="fu">sudo</span> make install</code></pre></div>
<p>A instalação vai criar alguns diretório e fazer as seguintes cópias dos arquivos para os caminhos:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">/bin/mkdir</span> -p <span class="st">&#39;/usr/local/bin&#39;</span>
<span class="ex">/usr/bin/install</span> -c teste <span class="st">&#39;/usr/local/bin&#39;</span>

<span class="ex">/bin/mkdir</span> -p <span class="st">&#39;/usr/local/share/doc/teste&#39;</span>
<span class="ex">/usr/bin/install</span> -c -m 644 README.md <span class="st">&#39;/usr/local/share/doc/teste</span>

<span class="st">/bin/mkdir -p &#39;</span>/usr/local/share/doc/teste<span class="st">&#39;</span>
<span class="st">/usr/bin/install -c -m 644 my-example-teste.dat &#39;</span>/usr/local/share/doc/teste<span class="st">&#39;</span>

<span class="st">/bin/mkdir -p &#39;</span>/usr/local/share/man/man1<span class="st">&#39;</span>
<span class="st">/usr/bin/install -c -m 644 teste.1 &#39;</span>/usr/local/share/man/man1<span class="st">&#39;</span>

<span class="st">/bin/mkdir -p &#39;</span>/usr/local/bin<span class="st">&#39;</span>
<span class="st">/usr/bin/install -c script-teste.sh &#39;</span>/usr/local/bin<span class="st">&#39;</span></code></pre></div>
<blockquote>
<p>'</p>
</blockquote>
<ul>
<li>Se rodar o comando: <code>teste</code>(independente do diretório que você estiver) vai obter a saída da execução do programa: <strong>Somente um teste para o Autotools</strong>;</li>
<li>Se rodar o comando: <code>script-teste.sh</code>(independente do diretório que você estiver) vai obter a saída da execução do programa: <strong>Only a teste</strong>;</li>
<li>Se rodar o comando: <code>info teste</code> ou <code>man teste</code>(independente do diretório que você estiver) vai obter o manual;</li>
<li>Se quiser ver a documentação, execute: <code>cat /usr/local/share/doc/teste/README.md</code>;</li>
<li>Se quiser ver os exemplos, execute: <code>cat /usr/local/share/doc/teste/my-example-teste.dat</code>.</li>
</ul>
<p>Para desinstalar precisará estar no diretório de <code>testes/</code> e rode o comando:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> make uninstall</code></pre></div>
<p>Absolutamente TUDO será desinstalado, a saída será similar/igual:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">marcos@gentoo</span> ~/testes $ sudo make uninstall
<span class="ex">Senha</span>:
<span class="ex">Making</span> uninstall in src
<span class="ex">make</span>[1]: Entering directory <span class="st">&#39;/home/marcos/testes/src&#39;</span>
 <span class="kw">(</span> <span class="bu">cd</span> <span class="st">&#39;/usr/local/bin&#39;</span> <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> -f teste <span class="kw">)</span>
<span class="ex">make</span>[1]: Leaving directory <span class="st">&#39;/home/marcos/testes/src&#39;</span>
<span class="ex">Making</span> uninstall in doc
<span class="ex">make</span>[1]: Entering directory <span class="st">&#39;/home/marcos/testes/doc&#39;</span>
 <span class="kw">(</span> <span class="bu">cd</span> <span class="st">&#39;/usr/local/share/doc/teste&#39;</span> <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> -f README.md <span class="kw">)</span>
<span class="ex">make</span>[1]: Leaving directory <span class="st">&#39;/home/marcos/testes/doc&#39;</span>
<span class="ex">Making</span> uninstall in examples
<span class="ex">make</span>[1]: Entering directory <span class="st">&#39;/home/marcos/testes/examples&#39;</span>
 <span class="kw">(</span> <span class="bu">cd</span> <span class="st">&#39;/usr/local/share/doc/teste&#39;</span> <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> -f my-example-teste.dat <span class="kw">)</span>
<span class="ex">make</span>[1]: Leaving directory <span class="st">&#39;/home/marcos/testes/examples&#39;</span>
<span class="ex">Making</span> uninstall in man
<span class="ex">make</span>[1]: Entering directory <span class="st">&#39;/home/marcos/testes/man&#39;</span>
 <span class="kw">(</span> <span class="bu">cd</span> <span class="st">&#39;/usr/local/share/man/man1&#39;</span> <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> -f teste.1 <span class="kw">)</span>
<span class="ex">make</span>[1]: Leaving directory <span class="st">&#39;/home/marcos/testes/man&#39;</span>
<span class="ex">Making</span> uninstall in scripts
<span class="ex">make</span>[1]: Entering directory <span class="st">&#39;/home/marcos/testes/scripts&#39;</span>
 <span class="kw">(</span> <span class="bu">cd</span> <span class="st">&#39;/usr/local/bin&#39;</span> <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> -f script-teste.sh <span class="kw">)</span>
<span class="ex">make</span>[1]: Leaving directory <span class="st">&#39;/home/marcos/testes/scripts&#39;</span>
<span class="ex">make</span>[1]: Entering directory <span class="st">&#39;/home/marcos/testes&#39;</span>
<span class="ex">make</span>[1]: Nothing to be done for <span class="st">&#39;uninstall-am&#39;</span>.
<span class="ex">make</span>[1]: Leaving directory <span class="st">&#39;/home/marcos/testes&#39;</span>
<span class="ex">marcos@gentoo</span> ~/testes $</code></pre></div>
<h2 id="º-parte-preparando-os-arquivos-ou-gerando-tudo-via-shell-script">3º Parte: Preparando os arquivos ou Gerando tudo via Shell Script</h2>
<p>Caso deseje ver funcionando tudo que fizemos aqui, use arquivos pré-prontos ou execute um script simples de Bash:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">git</span> clone https://github.com/terroo/gnu-autotools
<span class="bu">cd</span> gnu-autotools/</code></pre></div>
<p>E use os arquivos de ambiente já pré-criados: <code>gnu-autotools/testes/</code> ou simplesmente rode o script que cria os arquivos do zero: <code>./gnu-autotools.sh</code></p>
<p>Ou gere tudo inclusive os comandos do <strong>Autotools</strong> via script com o arquivo: <code>./gnu-autotools-full.sh</code></p>
<hr />
<h2 id="º-parte-explicando-os-arquivos-e-comandos-do-autotools">4º Parte: Explicando os arquivos e comandos do Autotools</h2>
<p>Em resumo o <a href="">GNU Autotools</a> : + Checa a disponiblidade de bibliotecas necessárias; + Possivelmente ajusta algumas coisas (como alguns caminhos em scripts ou em documentação) em tempo de compilação; + Instalar tudo em seu lugar; + Tudo isso de forma padronizada e com tratamento de todos os possíveis erros que podem existir na construção e instalação de um software; + O comando <code>autoscan</code> tenta produzir uma arquivo configure.ac correto pela execução de analises simples nos arquivos do pacote; + O comando <code>autoconf</code> produz dois arquivos: <code>autom4te.cache</code> e o <code>configure</code>; + O diretório <code>autom4te.cache</code> é um diretório usado para acelerar o trabalho das ferramentas, e pode ser removido quando o pacote for liberado; + O arquivo <code>configure</code> é o script shell que é chamado pelos usuários finais. Nesse ponto, o que o arquivo configure faz é somente checar por dependências como sugerido pelo <em>autoscan</em>, então nada muito conclusivo ainda; + Após já ter a parte de checagem do sistema, partimos para a compilação e instalação. Isso é feito pela cooperação entre o <code>automake</code> o <code>autoconf</code>. O <code>automake</code> gera alguns &quot;modelos&quot; que os scripts gerados pelo <code>autoconf</code> traduzirão nos Makefiles. Um arquivo makefile inicial é necessário na raiz do pacote: <strong>./Makefile.am</strong>; + A linha referente à <strong>AUTOMAKE_OPTIONS = foreign</strong> configura o modo que o <code>automake</code> assumirá. O modo &quot;foreign&quot; significa não GNU, e é comum ser usado; + A segunda linha mostra a lista de sub-diretórios onde se encontram os arquivos a serem trabalhados. O primeiro tem as coisas a serem compiladas, enquanto o resto apenas precisa ser instalado, mas nós não nos importamos com esse arquivo. Iremos preparar agora o arquivo <code>Makefile.am</code> para cada um desses diretórios. O <code>automake</code> irá passar por casa um deles para produzir o arquivo <code>Makefile.in</code> correspondente. Esses arquivos <code>*.in</code> serão usados pelos scripts do <code>autoconf</code> para produzir os arquivos <code>Makefile</code> finais. + Geralmente no arquivo <code>src/Makefile.am</code> definimos todos os arquivos que serão criados e compilados. Em geral, os sufixos em letras maiúsculas como &quot;_PROGRAMS&quot; são chamados <strong>primary</strong> e dizem parcialmente o que executar no seu argumento; os prefixos, em letras minúsculas (não tem um nome pré-fixado) dizem o diretório onde será instalado. Para informar diversos arquivos, usa-se assim mais ou menos:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="co"># what flags you want to pass to the C compiler &amp; linker</span>
<span class="ex">CFLAGS</span> = --pedantic -Wall -std=c99 -O2
<span class="ex">LDFLAGS</span> =
<span class="co"># this lists the binaries to produce, the (non-PHONY, binary) targets in</span>
<span class="co"># the previous manual Makefile</span>
<span class="ex">bin_PROGRAMS</span> = targetbinary1 targetbinary2 [...] targetbinaryN
<span class="ex">targetbinary1_SOURCES</span> = targetbinary1.c myheader.h [...]
<span class="ex">targetbinary2_SOURCES</span> = targetbinary2.c
<span class="ex">.</span>
<span class="ex">.</span>
<span class="ex">targetbinaryN_SOURCES</span> = targetbinaryN.c</code></pre></div>
<ul>
<li>Os arquivos em <code>scripts/</code> geralmente possuem o Shell Script que irá chamar o executável, bem como modelos de autocomplete(compgen) de parâmetros. Utilizamos um conteúdo de exemplo, mas o certo mesmo seria assim (exemplo do script do Firefox):</li>
</ul>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="co">#!/bin/sh</span>
<span class="bu">unset</span> <span class="va">LD_PRELOAD</span>
<span class="va">LD_LIBRARY_PATH=</span><span class="st">&quot;/usr/lib64/apulse:/opt/firefox/&quot;</span> <span class="kw">\</span>
<span class="va">GTK_PATH=</span>/usr/lib64/gtk-3.0/ <span class="kw">\</span>
<span class="bu">exec</span> /opt/firefox/firefox <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span></code></pre></div>
<p>Ou seja, ele chamará o executável que foi compilado e instalado em <code>/opt</code> no seu devido diretório ; + O comando <code>aclocal</code> cria as ferramentas que geram cada script gera o arquivo <code>aclocal.m4</code> que contém <strong>macros</strong> para as coisas do <code>automake</code>; + O comando <code>automake</code> lê o <code>configure.ac</code> e o <code>Makefile.a</code>m, interpreta-os e, para cada <code>Makefile.am</code> produz um <code>Makefile.in</code>. O argumento <code>--add-missing</code> diz ao <code>automake</code> para fornecer scripts padrão para qualquer erro reportado, assim pode ser omitido nas próximas execuções. + O comando <code>autoreconf</code>(usado para regularizar a falta de <code>config.h.in</code>) compila todas as ferramentas relevantes na ordem correta e instala os arquivos ausentes. Os parâmetros <code>-f</code>(considera que tudo está obsoleto e força a reconfiguração) e <code>-i</code> (faz uma cópia de arquivos auxiliares presentes no sistema para seu projeto, chama o <code>autoheader</code>) . Ainda poderíamos unir ao parâmetro <code>-v</code> ficando <code>-vfi</code> para ver os detalhes dos procedimentos.</p>
<hr />
<h2 id="resumindo">Resumindo</h2>
<p><code>autotools</code> → <code>autoscan</code>(configure.scan) → <code>configure.ac</code> → <code>autoconf</code>(autom4te.cache e configure inicial) → <code>Makefile.am</code>(<code>*</code>) → <code>aclocal</code>(aclocal.m4) → <code>automake</code>(Makefile.in) → <code>autoreconf</code>(<code>config.h.in/header</code>) → autoconf(<code>./configure</code>) → <code>Makefile</code>(make &amp;&amp; make install)</p>
<div class="figure">
<img src="400px-Autoconf-automake-process.svg.png" alt="Autotools" />
<p class="caption">Autotools</p>
</div>
<hr />
<h2 id="referências">Referências</h2>
<ul>
<li><a href="https://www.gnu.org/software/autoconf/" class="uri">https://www.gnu.org/software/autoconf/</a></li>
<li><a href="https://www.gnu.org/software/automake/" class="uri">https://www.gnu.org/software/automake/</a></li>
<li><a href="https://www.gnu.org/software/libtool/" class="uri">https://www.gnu.org/software/libtool/</a></li>
<li><a href="https://www.gnu.org/software/make/" class="uri">https://www.gnu.org/software/make/</a></li>
<li><a href="https://www.gnu.org/software/gettext/" class="uri">https://www.gnu.org/software/gettext/</a></li>
<li><a href="https://en.wikipedia.org/wiki/GNU_Autotools" class="uri">https://en.wikipedia.org/wiki/GNU_Autotools</a></li>
<li><a href="https://klebermota.eti.br/2010/10/13/tutorial-para-criar-a-estrutura-de-arquivos-do-autoconf-automake-para-seu-projeto/" class="uri">https://klebermota.eti.br/2010/10/13/tutorial-para-criar-a-estrutura-de-arquivos-do-autoconf-automake-para-seu-projeto/</a></li>
<li><a href="https://developer.gnome.org/anjuta-build-tutorial/stable/create-autotools.html.en" class="uri">https://developer.gnome.org/anjuta-build-tutorial/stable/create-autotools.html.en</a></li>
<li><a href="https://dwheeler.com/autotools/" class="uri">https://dwheeler.com/autotools/</a></li>
</ul>
